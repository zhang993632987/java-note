# CAS

> **独占锁是一项**<mark style="color:blue;">**悲观**</mark>**技术——它假设最坏的情况，并且只有在确保其他线程不会造成干扰的情况下才能执行下去。**

CAS 包含了 3 个操作数——**需要读写的内存位置 V**、**进行比较的值 A** 和**拟写入的新值 B**。

* **当且仅当 V的值等于 A 时，CAS 才会通过原子方式用新值 B 来更新 V 的值**，否则不会执行任何操作。
* **无论位置 V 的值是否等于 A，都将返回 V 原有的值。**

CAS的含义是：“<mark style="color:blue;">**我认为V的值应该为A，如果是，那么将V的值更新为B，否则不修改并告诉V的值实际为多少**</mark>”。

> **CAS是一项**<mark style="color:blue;">**乐观**</mark>**的技术，它希望能成功地执行更新操作，并且如果有另一个线程在最近一次检查后更新了该变量，那么CAS能检测到这个错误。**

{% hint style="info" %}
## <mark style="color:blue;">提示</mark>

CAS 的典型使用模式是：**首先从 V 中读取值 A，并根据 A 计算新值 B，然后再通过 CAS 以原子方式将 V 中的值由 A 变成 B。**

通常，当更新失败时（V 的值已经被其他线程改变了），反复地重试是一种合理的策略，但**在一些竞争很激烈的情况下，更好的方式是在重试之前首先等待一段时间或者回退，从而避免造成活锁问题。**
{% endhint %}
